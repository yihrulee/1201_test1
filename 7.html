<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤ç‰©çš„é‹è¼¸æŒ‘æˆ°è³½</title>
    <style>
        :root {
            --primary-color: #2e5c3e;
            --water-bg: linear-gradient(180deg, #a1c4fd 0%, #c2e9fb 100%);
            --fish-size: 60px;
            --bubble-size: 90px;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* é˜²æ­¢éŠæˆ²ä¸­é¸å–æ–‡å­— */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background: var(--water-bg);
            display: flex;
            flex-direction: column;
        }

        /* --- UI ä»‹é¢å€ --- */
        #game-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* å¢åŠ ä¸€é»åº•éƒ¨é‚Šè·ï¼Œç¢ºä¿ä¸èˆ‡éŠæˆ²å€å¤ªè¿‘ */
            padding-bottom: 20px;
        }

        #score-board {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }

        #question-box {
            font-size: 1.4rem;
            text-align: center;
            font-weight: bold;
            color: #333;
            max-width: 900px;
            line-height: 1.5;
            min-height: 3rem; /* é ç•™é«˜åº¦ */
        }

        /* é—œéµå­—é¡è‰² */
        .kw-blue { color: #2b6cb0; }
        .kw-red { color: #c53030; }
        .kw-green { color: #2e5c3e; }
        .kw-orange { color: #d97706; }

        /* --- éŠæˆ²å€åŸŸ --- */
        #game-area {
            position: relative;
            flex: 1;
            width: 100%;
            overflow: hidden;
            cursor: none; /* éŠæˆ²ä¸­éš±è—æ»‘é¼ æ¸¸æ¨™ */
            /* è®“éŠæˆ²å€å…§å®¹å¾€ä¸‹åç§»ï¼Œé¿å…è¢« Header è“‹ä½å¤ªåš´é‡ */
            margin-top: 100px; 
        }

        /* å°é­š */
        #player {
            position: absolute;
            width: var(--fish-size);
            height: var(--fish-size);
            font-size: 50px;
            line-height: 1;
            left: 50px;
            top: 50%;
            /* ã€ä¿®æ”¹é» 1ã€‘å¢åŠ  scaleX(-1) è®“é­šé ­æ°´å¹³ç¿»è½‰é¢å‘å³é‚Šï¼ŒåŒæ™‚ä¿æŒå‚ç›´å±…ä¸­ */
            transform: scaleX(-1) translateY(-50%);
            z-index: 5;
            transition: top 0.1s ease-out; /* è®“éµç›¤ç§»å‹•å¹³æ»‘ */
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
        }

        /* ç­”æ¡ˆæ³¡æ³¡ */
        .bubble {
            position: absolute;
            padding: 15px;
            background: white;
            border: 3px solid #4a90e2;
            border-radius: 50px;
            color: #333;
            font-weight: bold;
            font-size: 1.1rem;
            white-space: nowrap;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 4;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ç‰¹æ•ˆ (æ„›å¿ƒ/é­ç‚®) */
        .effect {
            position: absolute;
            font-size: 3rem;
            z-index: 20;
            animation: popUp 0.8s forwards;
            pointer-events: none;
        }

        @keyframes popUp {
            0% { transform: scale(0.5) translateY(0); opacity: 1; }
            50% { transform: scale(1.2) translateY(-20px); opacity: 1; }
            100% { transform: scale(1) translateY(-40px); opacity: 0; }
        }

        /* --- é é¢å±¤ (é–‹å§‹/çµæŸ) --- */
        .overlay-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
        }

        .overlay-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 90%;
            border: 5px solid var(--primary-color);
        }

        h1 { color: var(--primary-color); margin-bottom: 20px; font-size: 2.5rem; }
        h2 { color: #333; margin-bottom: 10px; }
        p { font-size: 1.1rem; color: #555; line-height: 1.8; margin-bottom: 20px; }

        .btn-start {
            background-color: var(--primary-color);
            color: white;
            font-size: 1.5rem;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-start:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* --- åº•éƒ¨å°è¦½åˆ— --- */
        footer {
            background: #fff;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #ddd;
            z-index: 101; /* æ¯” overlay é«˜ */
        }

        .nav-btn {
            text-decoration: none;
            padding: 10px 24px;
            border-radius: 30px;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .prev-btn { background-color: #f0f0f0; color: #333; border: 1px solid #ccc; }
        .prev-btn:hover { background-color: #e0e0e0; }

        .next-btn { background-color: var(--primary-color); color: white; }
        .next-btn:hover { transform: translateY(-2px); background-color: #244a32; }

        .next-btn.disabled {
            background-color: #ccc;
            pointer-events: none;
            opacity: 0.7;
        }

    </style>
</head>
<body>

    <div id="game-header">
        <div id="score-board">
            <span>å¾—åˆ†: <span id="score-display">55</span></span>
            <span>é€²åº¦: <span id="progress-display">0/15</span></span>
        </div>
        <div id="question-box">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
    </div>

    <div id="game-area">
        <div id="player">ğŸŸ</div>
        </div>

    <div id="start-screen" class="overlay-screen">
        <div class="overlay-content">
            <h1>æ¤ç‰©çš„é‹è¼¸æŒ‘æˆ°è³½</h1>
            <p>
                æ­¡è¿ä¾†åˆ°æ·±æµ·æ•™å®¤ï¼<br>
                è«‹å¹«åŠ©å°é­šæ¸¸å‘æ­£ç¢ºçš„ç­”æ¡ˆã€‚<br><br>
                <strong>æ“ä½œæ–¹å¼ï¼š</strong>ä½¿ç”¨ã€Œæ»‘é¼ æ¸¸æ¨™ã€æˆ–éµç›¤ã€Œâ†‘ â†“ã€ç§»å‹•å°é­šã€‚<br>
                <strong>è¦å‰‡ï¼š</strong><br>
                âœ… ç­”å°ï¼š+3åˆ† (å‡ºç¾æ„›å¿ƒ â¤ï¸)<br>
                âŒ ç­”éŒ¯ï¼š-3åˆ† (å‡ºç¾é­ç‚® ğŸ’¥)<br>
                ğŸ’¨ æ²’åƒåˆ°ï¼šä¸è¨ˆåˆ†<br>
                <strong>åŸºæœ¬åˆ† 55 åˆ†ï¼Œå…± 15 é¡Œã€‚</strong>
            </p>
            <button class="btn-start" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <div id="end-screen" class="overlay-screen" style="display: none;">
        <div class="overlay-content">
            <h1>éŠæˆ²çµæŸ</h1>
            <h2>ä½ çš„æœ€çµ‚å¾—åˆ†</h2>
            <p style="font-size: 3rem; font-weight: bold; color: #c53030;" id="final-score">0</p>
            <p id="feedback-text">æ­å–œå®ŒæˆæŒ‘æˆ°ï¼é»æ“Šå³ä¸‹è§’å‰å¾€ä¸‹ä¸€é ã€‚</p>
        </div>
    </div>

    <footer>
        <a href="6.html" class="nav-btn prev-btn">â† ä¸Šä¸€é </a>
        <a href="./8.html" id="nextPageBtn" class="nav-btn next-btn disabled">ä¸‹ä¸€é  â†’</a>
    </footer>

    <script>
        // --- é¡Œåº«è³‡æ–™ (15é¡Œ) ---
        const questions = [
            { q: "æ¤ç‰©é«”å…§è² è²¬é‹è¼¸<span class='kw-blue'>æ°´åˆ†</span>çš„æ§‹é€ æ˜¯ï¼Ÿ", options: ["æœ¨è³ªéƒ¨", "éŸŒçš®éƒ¨", "å½¢æˆå±¤"], ans: "æœ¨è³ªéƒ¨" },
            { q: "æ¤ç‰©é«”å…§è² è²¬é‹è¼¸<span class='kw-orange'>é¤Šåˆ†</span>çš„æ§‹é€ æ˜¯ï¼Ÿ", options: ["æœ¨è³ªéƒ¨", "éŸŒçš®éƒ¨", "è¡¨çš®ç´°èƒ"], ans: "éŸŒçš®éƒ¨" },
            { q: "æœ¨è³ªéƒ¨é‹è¼¸æ°´åˆ†çš„æ–¹å‘é€šå¸¸ç‚ºä½•ï¼Ÿ", options: ["ç”±ä¸‹å¾€ä¸Š", "ç”±ä¸Šå¾€ä¸‹", "é›™å‘é‹è¼¸"], ans: "ç”±ä¸‹å¾€ä¸Š" },
            { q: "éŸŒçš®éƒ¨é‹è¼¸é¤Šåˆ†çš„æ–¹å‘ç‚ºä½•ï¼Ÿ", options: ["åƒ…ç”±ä¸Šå¾€ä¸‹", "åƒ…ç”±ä¸‹å¾€ä¸Š", "é›™å‘çš†å¯"], ans: "é›™å‘çš†å¯" },
            { q: "é«˜å¤§æ¨¹æœ¨æ°´åˆ†å‘ä¸Šé‹è¼¸çš„ä¸»è¦<span class='kw-blue'>å‹•åŠ›ä¾†æº</span>æ˜¯ï¼Ÿ", options: ["å…‰åˆä½œç”¨", "è’¸æ•£ä½œç”¨", "å‘¼å¸ä½œç”¨"], ans: "è’¸æ•£ä½œç”¨" },
            { q: "æ§åˆ¶æ°£å­”é–‹é–‰çš„ç´°èƒæ˜¯ï¼Ÿ", options: ["è¡¨çš®ç´°èƒ", "è‘‰è‚‰ç´°èƒ", "ä¿è¡›ç´°èƒ"], ans: "ä¿è¡›ç´°èƒ" },
            { q: "é›™å­è‘‰æ¤ç‰©è–çš„ç¶­ç®¡æŸä¸­ï¼Œ<span class='kw-green'>å…§å´</span>çš„éƒ¨åˆ†æ˜¯ï¼Ÿ", options: ["æœ¨è³ªéƒ¨", "éŸŒçš®éƒ¨", "å½¢æˆå±¤"], ans: "æœ¨è³ªéƒ¨" },
            { q: "é›™å­è‘‰æ¤ç‰©è–çš„ç¶­ç®¡æŸä¸­ï¼Œ<span class='kw-green'>å¤–å´</span>çš„éƒ¨åˆ†æ˜¯ï¼Ÿ", options: ["æœ¨è³ªéƒ¨", "éŸŒçš®éƒ¨", "å½¢æˆå±¤"], ans: "éŸŒçš®éƒ¨" },
            { q: "æ ¹éƒ¨å¢åŠ å¸æ”¶è¡¨é¢ç©çš„æ§‹é€ æ˜¯ï¼Ÿ", options: ["æ ¹æ¯›", "æ°£å­”", "æ”¯æ ¹"], ans: "æ ¹æ¯›" },
            { q: "ç•¶ä¿è¡›ç´°èƒ<span class='kw-blue'>å¸æ°´è†¨è„¹</span>æ™‚ï¼Œæ°£å­”æœƒï¼Ÿ", options: ["é—œé–‰", "å¼µé–‹", "æ¶ˆå¤±"], ans: "å¼µé–‹" },
            { q: "å½¢æˆå¹´è¼ªçš„ä¸»è¦åŸå› æ˜¯ï¼Ÿ", options: ["ç´°èƒç”Ÿé•·é€Ÿåº¦ä¸åŒ", "å—å‚·ç™’åˆ", "æ°´åˆ†å¤šå¯¡"], ans: "ç´°èƒç”Ÿé•·é€Ÿåº¦ä¸åŒ" },
            { q: "ç§‹å†¬å­£ç¯€ç”Ÿé•·çš„æœ¨æé¡è‰²è¼ƒæ·±ï¼ŒåŸå› æ˜¯ï¼Ÿ", options: ["ç´°èƒå°ã€å£åš", "ç´°èƒå¤§ã€å£è–„", "ç´°èƒå«è‘‰ç¶ é«”"], ans: "ç´°èƒå°ã€å£åš" },
            { q: "å°‡æ¨¹å¹¹ç’°ç‹€å‰çš®æœƒå°è‡´æ¨¹æœ¨æ­»äº¡ï¼Œæ˜¯å› åˆ‡æ–·äº†ä½•è™•ï¼Ÿ", options: ["æœ¨è³ªéƒ¨", "éŸŒçš®éƒ¨", "å½¢æˆå±¤"], ans: "éŸŒçš®éƒ¨" },
            { q: "å–®å­è‘‰æ¤ç‰©(å¦‚ç‰ç±³)è–å…§ç¶­ç®¡æŸçš„æ’åˆ—æ–¹å¼ç‚ºï¼Ÿ", options: ["ç’°ç‹€æ’åˆ—", "æ•£ç”Ÿæ’åˆ—", "åå­—æ’åˆ—"], ans: "æ•£ç”Ÿæ’åˆ—" },
            { q: "æ°´åˆ†é€²å…¥æ ¹éƒ¨ç¶­ç®¡æŸçš„ä¸»è¦ç‰©ç†æ©Ÿåˆ¶æ˜¯ï¼Ÿ", options: ["æ“´æ•£èˆ‡æ»²é€", "ä¸»å‹•é‹è¼¸", "è’¸æ•£ä½œç”¨"], ans: "æ“´æ•£èˆ‡æ»²é€" }
        ];

        // --- éŠæˆ²è®Šæ•¸ ---
        let currentScore = 55;
        let questionIdx = 0;
        let gameActive = false;
        let animationFrameId;
        let bubbles = []; 
        let questionAnswered = false; 
        
        // DOM å…ƒç´ 
        const player = document.getElementById('player');
        const gameArea = document.getElementById('game-area');
        const scoreDisplay = document.getElementById('score-display');
        const progressDisplay = document.getElementById('progress-display');
        const questionBox = document.getElementById('question-box');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const finalScoreText = document.getElementById('final-score');
        const nextBtn = document.getElementById('nextPageBtn');

        // å°é­šä½ç½®
        let playerY = 300;
        let targetY = 300; // æ»‘é¼ ç›®æ¨™ä½ç½®

        // --- éŠæˆ²æ§åˆ¶ ---
        
        function startGame() {
            startScreen.style.display = 'none';
            gameActive = true;
            currentScore = 55;
            questionIdx = 0;
            scoreDisplay.innerText = currentScore;
            
            shuffleArray(questions);
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('keydown', handleKeyDown);

            loadQuestion();
            gameLoop();
        }

        function loadQuestion() {
            if (questionIdx >= questions.length) {
                endGame();
                return;
            }

            const qData = questions[questionIdx];
            questionBox.innerHTML = qData.q;
            progressDisplay.innerText = `${questionIdx + 1}/${questions.length}`;
            questionAnswered = false;

            bubbles.forEach(b => b.el.remove());
            bubbles = [];

            let options = qData.options.map(opt => ({
                text: opt,
                isCorrect: opt === qData.ans
            }));
            shuffleArray(options);

            // ã€ä¿®æ”¹é» 2ã€‘èª¿æ•´æ³¡æ³¡å‚ç›´ä½ç½®è¨ˆç®—ï¼Œé¿å…èˆ‡é¡Œç›®é‡ç–Š
            const areaHeight = gameArea.clientHeight;
            const paddingTop = 120; // é ‚éƒ¨ä¿ç•™ç©ºé–“ (å¢åŠ æ­¤å€¼å¯è®“é¸é …æ›´å¾€ä¸‹)
            const usableHeight = areaHeight - paddingTop; // å¯¦éš›å¯ç”¨æ–¼åˆ†å¸ƒæ³¡æ³¡çš„é«˜åº¦
            const segment = usableHeight / 3; // å°‡å¯ç”¨é«˜åº¦åˆ†ç‚ºä¸‰æ®µ

            options.forEach((opt, index) => {
                const el = document.createElement('div');
                el.className = 'bubble';
                el.innerText = opt.text;
                gameArea.appendChild(el);

                const startX = gameArea.clientWidth + 50 + (Math.random() * 100); 
                // è¨ˆç®— Y åº§æ¨™ï¼šé ‚éƒ¨ä¿ç•™å€ + è©²æ®µèµ·å§‹ä½ç½® + è©²æ®µå±…ä¸­åç§» - æ³¡æ³¡è‡ªèº«åŠé«˜ä¿®æ­£
                const startY = paddingTop + (segment * index) + (segment / 2) - 40; 

                bubbles.push({
                    el: el,
                    x: startX,
                    y: startY,
                    speed: 3 + (questionIdx * 0.15) + (Math.random() * 1), 
                    isCorrect: opt.isCorrect,
                    active: true
                });
            });
        }

        function gameLoop() {
            if (!gameActive) return;

            const dy = targetY - playerY;
            playerY += dy * 0.1; 
            
            const maxH = gameArea.clientHeight - 60;
            if (playerY < 0) playerY = 0;
            if (playerY > maxH) playerY = maxH;
            
            player.style.top = playerY + 'px';

            let activeBubbleCount = 0;

            bubbles.forEach(b => {
                if (!b.active) return;

                b.x -= b.speed;
                b.el.style.left = b.x + 'px';
                b.el.style.top = b.y + 'px';

                if (b.x < -200) {
                    b.active = false;
                    b.el.remove();
                } else {
                    activeBubbleCount++;
                }

                if (!questionAnswered && isColliding(player, b.el)) {
                    handleCollision(b);
                }
            });

            if (questionAnswered || activeBubbleCount === 0) {
                if (!window.isTransitioning) {
                    window.isTransitioning = true;
                    setTimeout(() => {
                        questionIdx++;
                        loadQuestion();
                        window.isTransitioning = false;
                    }, 500); 
                }
            }

            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function handleCollision(bubble) {
            questionAnswered = true; 
            bubble.active = false;
            bubble.el.style.display = 'none'; 

            const rect = player.getBoundingClientRect();
            const x = rect.left + 30;
            const y = rect.top;

            if (bubble.isCorrect) {
                currentScore += 3;
                showEffect('â¤ï¸', x, y);
                player.innerText = 'ğŸ˜‹'; 
            } else {
                currentScore -= 3;
                showEffect('ğŸ’¥', x, y);
                player.innerText = 'ğŸ˜µ';
            }

            scoreDisplay.innerText = currentScore;
            setTimeout(() => player.innerText = 'ğŸŸ', 500);
        }

        function showEffect(emoji, x, y) {
            const el = document.createElement('div');
            el.className = 'effect';
            el.innerText = emoji;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function endGame() {
            gameActive = false;
            cancelAnimationFrame(animationFrameId);
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('keydown', handleKeyDown);
            
            gameArea.style.cursor = 'default';

            finalScoreText.innerText = currentScore;
            endScreen.style.display = 'flex';

            nextBtn.classList.remove('disabled');
        }

        // --- å·¥å…·å‡½å¼ ---
        
        function handleMouseMove(e) {
            const rect = gameArea.getBoundingClientRect();
            targetY = e.clientY - rect.top - 30; 
        }

        function handleKeyDown(e) {
            const step = 40;
            if (e.key === 'ArrowUp') {
                targetY -= step;
            } else if (e.key === 'ArrowDown') {
                targetY += step;
            }
        }

        function isColliding(div1, div2) {
            const rect1 = div1.getBoundingClientRect();
            const rect2 = div2.getBoundingClientRect();

            return !(rect1.right < rect2.left || 
                     rect1.left > rect2.right || 
                     rect1.bottom < rect2.top || 
                     rect1.top > rect2.bottom);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

    </script>
</body>
</html>