<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢ç©¶å¯¦é©—å­¸ç¿’å–®ï¼šéæ°§åŒ–æ°«é…¶æ´»æ€§æ¢è¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f4f7f6;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* ä¸»è¦å®¹å™¨ï¼šA4 å¯¬åº¦æ¨¡æ“¬ */
        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        h1 { text-align: center; border-bottom: none; margin-bottom: 30px; }

        /* ç¬¬ä¸€éƒ¨åˆ†ï¼šå­¸ç”Ÿè³‡è¨Š */
        .student-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            background-color: #e8f6f3;
            padding: 15px;
            border-radius: 8px;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        input[type="text"], input[type="number"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }

        /* ç¬¬äºŒéƒ¨åˆ†ï¼šå¯¦é©—èªªæ˜ */
        .intro-section p {
            line-height: 1.6;
            text-align: justify;
        }

        /* ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ•¸æ“šèˆ‡åœ–è¡¨ (å·¦å³æ’ç‰ˆ) */
        .data-chart-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: stretch; /* ç­‰é«˜ */
        }

        .data-table-section {
            flex: 1; /* ä½” 1/3 */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .chart-section {
            flex: 2; /* ä½” 2/3 */
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
            min-height: 300px;
        }

        /* è¡¨æ ¼æ¨£å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9rem;
        }

        .data-input {
            width: 80%;
            text-align: center;
        }

        /* ç¬¬å››~å…­éƒ¨åˆ†ï¼šè¨è«–å•é¡Œ */
        .discussion-section {
            margin-bottom: 20px;
            background: #fff;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .discussion-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--accent-color);
        }

        .question-block {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.95rem;
        }

        textarea {
            width: 100%;
            height: 60px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
            box-sizing: border-box;
        }

        /* æŒ‰éˆ•å€ */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1rem;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.3s;
            font-weight: bold;
        }

        .btn-img { background-color: #27ae60; }
        .btn-pdf { background-color: #e74c3c; }

        .btn:hover { opacity: 0.9; }

        /* iPad èªªæ˜å€ */
        .ipad-instructions {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
            line-height: 1.8;
        }

        /* RWD: æ‰‹æ©Ÿç‰ˆèª¿æ•´ç‚ºå‚ç›´æ’åˆ— */
        @media (max-width: 768px) {
            .data-chart-container {
                flex-direction: column;
            }
            .data-table-section, .chart-section {
                flex: auto;
                width: 100%;
            }
            .student-info {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

    <div class="container" id="worksheet">
        <h1>ç”Ÿç‰©æ¢ç©¶å¯¦é©—å­¸ç¿’å–®ï¼šéæ°§åŒ–æ°«é…¶æ´»æ€§</h1>

        <div class="student-info">
            <div class="input-group">
                <label>ç­ç´šï¼š</label>
                <input type="text" id="class-input" placeholder="ä¾‹å¦‚: 801">
            </div>
            <div class="input-group">
                <label>åº§è™Ÿï¼š</label>
                <input type="text" id="seat-input" placeholder="ä¾‹å¦‚: 05">
            </div>
            <div class="input-group">
                <label>å§“åï¼š</label>
                <input type="text" id="name-input" placeholder="ä¾‹å¦‚: ç‹å°æ˜">
            </div>
        </div>

        <div class="intro-section">
            <h2>äºŒã€å¯¦é©—ç›®çš„èˆ‡åŸç†</h2>
            <p>
                <strong>å¯¦é©—ç›®çš„ï¼š</strong>æ¢è¨ä¸åŒç”Ÿç‰©çµ„ç¹”ã€æº«åº¦åŠé…¸é¹¼åº¦å°é…µç´ ï¼ˆéæ°§åŒ–æ°«é…¶ï¼‰æ´»æ€§çš„å½±éŸ¿ã€‚<br>
                <strong>ç§‘å­¸åŸç†ï¼š</strong>ç”Ÿç‰©é«”å…§å«æœ‰éæ°§åŒ–æ°«é…¶ï¼ˆCatalaseï¼‰ï¼Œèƒ½å°‡æœ‰æ¯’çš„é›™æ°§æ°´ï¼ˆéæ°§åŒ–æ°« $H_2O_2$ï¼‰åˆ†è§£ç‚ºæ°´å’Œæ°§æ°£ã€‚åæ‡‰å¼ç‚ºï¼š$2H_2O_2 \rightarrow 2H_2O + O_2 \uparrow$ã€‚æœ¬å¯¦é©—è—‰ç”±æ¸¬é‡æ°§æ°£ç”¢ç”Ÿçš„å¤šå¯¡ï¼ˆæ³¡æ²«é«˜åº¦æˆ–æ’æ°´é›†æ°£é‡ï¼‰ï¼Œä¾†æ¨è«–é…µç´ åœ¨ä¸åŒç’°å¢ƒä¸‹çš„æ´»æ€§å¼·å¼±ã€‚
            </p>
        </div>

        <h2>ä¸‰ã€å¯¦é©—æ•¸æ“šç´€éŒ„èˆ‡çµ±è¨ˆ</h2>
        <div class="data-chart-container">
            <div class="data-table-section">
                <table>
                    <thead>
                        <tr>
                            <th>è©¦ç®¡ç·¨è™Ÿ / è™•ç†</th>
                            <th>æ°§æ°£ç”¢ç”Ÿé‡ (mL)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1. é…µæ¯èŒ</td>
                            <td><input type="number" class="data-input" id="val1" oninput="updateChart()"></td>
                        </tr>
                        <tr>
                            <td>2. ç…®æ²¸çš„é‡‘é‡è‡</td>
                            <td><input type="number" class="data-input" id="val2" oninput="updateChart()"></td>
                        </tr>
                        <tr>
                            <td>3. æ–°é®®çš„é‡‘é‡è‡</td>
                            <td><input type="number" class="data-input" id="val3" oninput="updateChart()"></td>
                        </tr>
                        <tr>
                            <td>4. ç´…è˜¿è”” (ç„¡é…¸)</td>
                            <td><input type="number" class="data-input" id="val4" oninput="updateChart()"></td>
                        </tr>
                        <tr>
                            <td>5. ç´…è˜¿è”” (åŠ é…¸)</td>
                            <td><input type="number" class="data-input" id="val5" oninput="updateChart()"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="chart-section">
                <canvas id="myChart"></canvas>
            </div>
        </div>

        <div class="discussion-section">
            <div class="discussion-title">å››ã€è¨è«–å•é¡Œ (I)ï¼šæ¯”è¼ƒç¬¬ 2 æ”¯èˆ‡ç¬¬ 3 æ”¯è©¦ç®¡ (é‡‘é‡è‡çµ„)</div>
            <div class="question-block">
                <label>(1) æ“ä½œè®Šå› æ˜¯ç”šéº¼ï¼Ÿ</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šæº«åº¦çš„è™•ç†ï¼ˆç…®æ²¸èˆ‡å¦ï¼‰..."></textarea>
            </div>
            <div class="question-block">
                <label>(2) è«‹å¯«å‡ºå¯¦é©—çµæœï¼š</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šæ–°é®®é‡‘é‡è‡ç”¢ç”Ÿå¤§é‡æ°§æ°£ï¼Œç…®æ²¸çš„å‰‡..."></textarea>
            </div>
            <div class="question-block">
                <label>(3) è«‹è§£é‡‹æ­¤å¯¦é©—çµæœçš„å¯èƒ½åŸå› ï¼š</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šé…µç´ ä¸»è¦æˆåˆ†ç‚ºè›‹ç™½è³ªï¼Œç…®æ²¸é«˜æº«æœƒå°è‡´..."></textarea>
            </div>
        </div>

        <div class="discussion-section">
            <div class="discussion-title">äº”ã€è¨è«–å•é¡Œ (II)ï¼šæ¯”è¼ƒç¬¬ 4 æ”¯èˆ‡ç¬¬ 5 æ”¯è©¦ç®¡ (ç´…è˜¿è””çµ„)</div>
            <div class="question-block">
                <label>(1) æ“ä½œè®Šå› æ˜¯ç”šéº¼ï¼Ÿ</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šé…¸é¹¼å€¼ï¼ˆæ˜¯å¦åŠ å…¥æª¸æª¬é…¸ï¼‰..."></textarea>
            </div>
            <div class="question-block">
                <label>(2) è«‹å¯«å‡ºå¯¦é©—çµæœï¼š</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šæœªåŠ é…¸çš„ç´…è˜¿è””æ°£æ³¡è¼ƒå¤šï¼ŒåŠ é…¸å¾Œçš„..."></textarea>
            </div>
            <div class="question-block">
                <label>(3) è«‹è§£é‡‹æ­¤å¯¦é©—çµæœçš„å¯èƒ½åŸå› ï¼š</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šé…µç´ å…·æœ‰ç‰¹å®šçš„æœ€ä½³é…¸é¹¼å€¼ç¯„åœï¼Œéé…¸ç’°å¢ƒæœƒ..."></textarea>
            </div>
        </div>

        <div class="discussion-section">
            <div class="discussion-title">å…­ã€è¨è«–å•é¡Œ (III)ï¼šæ¯”è¼ƒç¬¬ 1ã€3 æ”¯èˆ‡ç¬¬ 4 æ”¯è©¦ç®¡ (ä¸åŒç”Ÿç‰©)</div>
            <div class="question-block">
                <label>(1) æ“ä½œè®Šå› æ˜¯ç”šéº¼ï¼Ÿ</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šç”Ÿç‰©ç¨®é¡ï¼ˆé…µç´ ä¾†æºçš„ä¸åŒï¼‰..."></textarea>
            </div>
            <div class="question-block">
                <label>(2) è«‹å¯«å‡ºå¯¦é©—çµæœï¼š</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šä¸åŒç”Ÿç‰©çµ„ç¹”ç”¢ç”Ÿçš„æ°§æ°£é‡ä¸åŒ..."></textarea>
            </div>
            <div class="question-block">
                <label>(3) è«‹è§£é‡‹æ­¤å¯¦é©—çµæœçš„å¯èƒ½åŸå› ï¼š</label>
                <textarea placeholder="ä¾‹å¦‚ï¼šä¸åŒç”Ÿç‰©é«”å…§å«æœ‰çš„é…µç´ æ¿ƒåº¦æˆ–æ´»æ€§å¯èƒ½ä¸åŒ..."></textarea>
            </div>
        </div>

    </div>

    <div class="action-buttons">
        <button class="btn btn-img" onclick="downloadImage()">ä¸‹è¼‰å®Œæˆçš„å­¸ç¿’å–®åœ–ç‰‡</button>
        <button class="btn btn-pdf" onclick="downloadPDF()">ä¸‹è¼‰å®Œæˆçš„å­¸ç¿’å–®PDFï¼ˆA4 è‡ªå‹•åˆ†é ï¼‰</button>
    </div>

    <div class="container ipad-instructions">
        <h3>ğŸ“± ä½¿ç”¨ iPad æ™‚å¦‚ä½•å„²å­˜ PDFï¼Ÿ</h3>
        <p>å¦‚æœæ‚¨ä½¿ç”¨ iPadï¼ŒæŒ‰ä¸‹ã€Œä¸‹è¼‰ PDFã€å¾Œï¼ŒPDF æœƒåœ¨æ–°åˆ†é é–‹å•Ÿï¼Œè«‹ä¾ç…§ä¸‹åˆ—æ­¥é©Ÿå„²å­˜æª”æ¡ˆï¼š</p>
        <ol>
            <li>ç­‰å¾… PDF åœ¨æ–°åˆ†é é–‹å•Ÿã€‚</li>
            <li>é»å³ä¸Šè§’çš„ <strong>ã€Œåˆ†äº«ã€æŒ‰éˆ•</strong>ï¼ˆæ–¹æ¡†ï¼‹ä¸Šç®­é ­ï¼‰ã€‚</li>
            <li>é¸æ“‡ <strong>ã€Œå„²å­˜åˆ°æª”æ¡ˆã€</strong>ã€‚</li>
            <li>æª”åè«‹è¼¸å…¥ <strong>ã€ç­ç´šåº§è™Ÿå§“åã€‘</strong>ï¼ˆä¾‹å¦‚ï¼š80115ç‹å°æ˜ï¼‰ã€‚</li>
            <li>é¸æ“‡ã€Œå„²å­˜ã€ã€‚</li>
        </ol>
        <p>å®Œæˆå¾Œå³å¯å°‡ PDF ä¸Šå‚³çµ¦è€å¸«ï¼</p>
    </div>

    <script>
        // --- 1. åˆå§‹åŒ–åœ–è¡¨ ---
        const ctx = document.getElementById('myChart').getContext('2d');
        const initialData = [0, 0, 0, 0, 0];
        
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['1.é…µæ¯èŒ', '2.ç…®æ²¸é‡‘é‡è‡', '3.æ–°é®®é‡‘é‡è‡', '4.ç´…è˜¿è””(ç„¡é…¸)', '5.ç´…è˜¿è””(åŠ é…¸)'],
                datasets: [{
                    label: 'æ°§æ°£ç”¢ç”Ÿé‡ (mL)',
                    data: initialData,
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.6)', // è—
                        'rgba(255, 99, 132, 0.6)', // ç´…
                        'rgba(75, 192, 192, 0.6)', // ç¶ 
                        'rgba(255, 206, 86, 0.6)', // é»ƒ
                        'rgba(153, 102, 255, 0.6)' // ç´«
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'æ°§æ°£é«”ç© (mL)',
                            font: { size: 14, weight: 'bold' }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'è©¦ç®¡è™•ç†çµ„åˆ¥',
                            font: { size: 14, weight: 'bold' }
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'å„çµ„å¯¦é©—æ°§æ°£ç”¢ç”Ÿé‡çµ±è¨ˆåœ–',
                        font: { size: 18 }
                    },
                    legend: {
                        display: false
                    }
                }
            }
        });

        // --- 2. æ•¸æ“šæ›´æ–°é‚è¼¯ ---
        function updateChart() {
            const v1 = document.getElementById('val1').value || 0;
            const v2 = document.getElementById('val2').value || 0;
            const v3 = document.getElementById('val3').value || 0;
            const v4 = document.getElementById('val4').value || 0;
            const v5 = document.getElementById('val5').value || 0;

            myChart.data.datasets[0].data = [v1, v2, v3, v4, v5];
            myChart.update();
        }

        // --- 3. å–å¾—æª”å helper ---
        function getFilename() {
            const cls = document.getElementById('class-input').value.trim();
            const seat = document.getElementById('seat-input').value.trim();
            const name = document.getElementById('name-input').value.trim();
            
            if(cls && seat && name) {
                return `${cls}_${seat}_${name}`;
            }
            return 'ç”Ÿç‰©å¯¦é©—å­¸ç¿’å–®';
        }

        // --- 4. ä¸‹è¼‰åœ–ç‰‡åŠŸèƒ½ ---
        function downloadImage() {
            // å¼·åˆ¶æ²å‹•åˆ°é ‚éƒ¨ä»¥å…æˆªåœ–è·‘ç‰ˆ
            window.scrollTo(0,0);
            
            const element = document.getElementById('worksheet');
            
            html2canvas(element, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = getFilename() + '.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }

        // --- 5. ä¸‹è¼‰ PDF åŠŸèƒ½ (è‡ªå‹•åˆ†é è™•ç†) ---
        function downloadPDF() {
            window.scrollTo(0,0);
            const element = document.getElementById('worksheet');
            const { jsPDF } = window.jspdf;

            html2canvas(element, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                
                // åˆå§‹åŒ– PDF (A4 ç¸±å‘, å–®ä½ mm)
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = 210;
                const pdfHeight = 297;
                
                // åœ–ç‰‡åœ¨ PDF ä¸­çš„å°ºå¯¸
                const imgProps = pdf.getImageProperties(imgData);
                const imgWidth = pdfWidth; 
                const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
                
                let heightLeft = imgHeight;
                let position = 0;

                // ç¬¬ä¸€é 
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pdfHeight;

                // å¦‚æœé‚„æœ‰å…§å®¹ï¼Œæ–°å¢é é¢
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pdfHeight;
                }

                pdf.save(getFilename() + '.pdf');
            });
        }
    </script>
</body>
</html>